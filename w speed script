-- Auto Farm WinChest FIXED (Z = START | X = STOP) - No Double TP Bug!
-- Teleports every 10s | Respawn-safe | Debounce + Distance Check

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

local autoFarm = false
local farmLoop
local lastTP = 0
local TP_COOLDOWN = 2  -- Min 2s between TPs (fixes double TP)
local NEAR_DIST = 15   -- If closer than 15 studs, skip TP

local function getWinChest()
    local winChest = workspace:FindFirstChild("WinChest")
    if winChest and winChest:IsA("BasePart") then
        return winChest
    end
    return nil
end

local function isNearChest()
    local character = player.Character
    if not character then return false end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return false end
    
    local winChest = getWinChest()
    if not winChest then return false end
    
    return (hrp.Position - winChest.Position).Magnitude < NEAR_DIST
end

local function teleport()
    local now = tick()
    if now - lastTP < TP_COOLDOWN then 
        return  -- Cooldown active (no spam/double TP)
    end
    
    if isNearChest() then 
        return  -- Already near chest
    end
    
    local character = player.Character
    if not character then return end
    
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    local winChest = getWinChest()
    if not winChest then 
        print("âŒ WinChest not found!")
        return
    end
    
    hrp.CFrame = winChest.CFrame + Vector3.new(0, 5, 0)
    lastTP = now
    print("âœ… Teleported to WinChest!")
end

local function startFarm()
    if autoFarm then return end
    autoFarm = true
    print("ðŸŸ¢ AUTO FARM ON! (Every 10s | Press X to STOP)")
    
    farmLoop = spawn(function()
        while autoFarm do
            teleport()
            wait(10)  -- 10s delay
        end
    end)
end

local function stopFarm()
    autoFarm = false
    print("ðŸ”´ AUTO FARM OFF")
end

-- Keybinds
UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.Z then
        startFarm()
    elseif input.KeyCode == Enum.KeyCode.X then
        stopFarm()
    end
end)

-- Respawn handler (auto TP if farming, but respects debounce)
player.CharacterAdded:Connect(function(char)
    char:WaitForChild("HumanoidRootPart", 5)
    if autoFarm then
        wait(1)  -- Slightly longer wait for stability
        teleport()  -- Uses debounce, so no double
    end
end)

print("ðŸš€ WinChest Auto Farm FIXED! | Z=Start | X=Stop | 10s Delay | No Double TP")
